var raster = null;var sel = null;var pos = 0;var size, scale;function initRaster() {    sel = getMatching({type: "raster", selected: true});    if (sel.length > 0) raster = sel[0];    return raster != null;}function setColor(art, color) {    if (art.type == "path") {        if (art.style.stroke.color != null) art.style.stroke.color = color;        if (art.style.fill.color != null) art.style.fill.color = color;    }    var child = art.firstChild;    while (child != null) {        setColor(child, color);        child = child.nextSibling;    }}function drawDot(x, y, dot, radius, col) {    if (radius > 0) {        var art = dot.clone();        var m = new Matrix();        m.scale(radius * scale);        m.translate(x * size, y * size);        art.transform(m);         setColor(art, col);        return art;    }    return null;}function rasterDot(dot, x, y, comp, color) {    var col = raster.getPixel(x, y);    if (comp = "gray") col.type = "gray";    else col.type = "cmyk";    var art = drawDot(x, raster.height - y, dot, col[comp], color);    return art;}function rasterComp(comp, reverse) {    var group = new Art("group");    var color = new Color(comp == "cyan" ? 1 : 0, comp == "magenta" ? 1 : 0, comp == "yellow" ? 1 : 0, (comp == "black" || comp == "gray") ? 1 : 0);	var dot = new Art("path");	dot.segments.push([size, reverse ? pos : (pos + scale * size)]);	dot.segments.push([0, reverse ? (pos + scale * size) : pos]);        var topDown = reverse;    var maxX = raster.width - 1;    var maxY = raster.height - 1;    for (var i = -maxY; i <= maxX; i++) {        var line = new Art("group");        group.append(line);        var prev = null;                if (topDown) {            var x = maxX;            var y = maxY - (maxX - i);            while (y <= maxX) {                if (y >= 0 && x >= 0) {                    var art = rasterDot(dot, reverse ? maxX - x : x, y, comp, color);                    if (art != null) {                        if (prev != null) art.moveAfter(prev);                        else line.append(art);                        prev = art;                    }                }                x--;                y++;            }        } else {            var x = i;            var y = maxY;            while (x <= maxX) {                if (x >= 0 && y >= 0) {                    var art = rasterDot(dot, reverse ? maxX - x : x, y, comp, color);                    if (art != null) {                        if (prev != null) art.moveAfter(prev);                        else line.append(art);                        prev = art;                    }                }                x++;                y--;            }        }//        dot.segments.reverse();    //    topDown = !topDown;    }            /*    for (var i = 0; i < raster.width; i++) {        for (var j = 0; j < raster.height; j++) {            var col = raster.getPixel(i, j);            col.type = "cmyk";            var art = drawDot(i, raster.height - j, dot, col[comp], color);            group.append(art);        }    }    */    dot.remove();    return group;}if (initRaster()) {    values = prompt("Enter Raster Values:", {type: "number", value: 10, title: "Grid Size:", width: 50},{type: "number", value: 100, title: "Object Scale (%):", width: 50});    if (values) {        size = values[0];        scale = values[1] / 100.0;        var reverse = false;        var gray = raster.getPixel(0, 0).type == "gray";        var scale = 1;        if (gray) {            var dot = new Art("path");            rasterComp("gray", reverse);        } else {            var inc = (reverse ? size / 2 : size / 4);            var dot = new Art("path");            rasterComp("black", false);            pos += inc;                var dot = new Art("path");            rasterComp("cyan", false);            pos += inc;            if (reverse) pos = 0;                var dot = new Art("path");            rasterComp("magenta", reverse);            pos += inc;                var dot = new Art("path");            rasterComp("yellow", reverse);        }                    for (var i = 0; i < sel.length; i++) {            sel[i].selected = false;        }    }}